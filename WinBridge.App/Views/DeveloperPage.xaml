<Page
    x:Class="WinBridge.App.Views.DeveloperPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:WinBridge.App.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:dev="using:WinBridge.App.Models.Dev"
    xmlns:store="using:WinBridge.App.Models.Store"
    xmlns:converters="using:WinBridge.App.Converters"
    mc:Ignorable="d"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Global Header -->
        <Grid Grid.Row="0" Margin="24,16" ColumnSpacing="16" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="0,0,0,1" Padding="0,0,0,16">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <TextBlock Text="Projet Actif :" VerticalAlignment="Center" Style="{StaticResource BodyStrongTextBlockStyle}"/>
            
            <ComboBox x:Name="RepoSelector" Grid.Column="1" HorizontalAlignment="Stretch"
                      ItemsSource="{x:Bind Projects}" 
                      SelectedItem="{x:Bind SelectedProject, Mode=TwoWay}" PlaceholderText="Sélectionner un projet...">
                <ComboBox.ItemTemplate>
                    <DataTemplate x:DataType="dev:DevProject">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="{x:Bind Name}"/>
                            <FontIcon Grid.Column="1" Glyph="&#xE718;" FontSize="12" Margin="8,0,0,0" 
                                      Visibility="{x:Bind IsDefault, Mode=OneWay, Converter={StaticResource BoolToVis}}" 
                                      Foreground="{ThemeResource SystemAccentColor}" ToolTipService.ToolTip="Projet par défaut"/>
                        </Grid>
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
                      
            <Button Grid.Column="2" Click="PinDefault_Click" ToolTipService.ToolTip="Définir comme projet par défaut">
                <SymbolIcon Symbol="Pin"/>
            </Button>
        </Grid>

        <!-- Main Pivot -->
        <Pivot Grid.Row="1">
            <!-- Item 1: Tableau de bord -->
            <PivotItem Header="Tableau de bord">
                <ScrollViewer Padding="24">
                    <StackPanel Spacing="32" MaxWidth="1200" HorizontalAlignment="Left">
                        <!-- Action Cards -->
                         <Grid ColumnSpacing="24">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- New Project Card -->
                            <Button Grid.Column="0" Click="OnNewProjectWizardClick" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                    Padding="0" BorderThickness="1" Background="{ThemeResource LayerFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" CornerRadius="8">
                                <Grid Padding="24">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <FontIcon Glyph="&#xE710;" FontSize="40" HorizontalAlignment="Left" Foreground="{ThemeResource AccentTextFillColorPrimaryBrush}"/>
                                    
                                    <StackPanel Grid.Row="1" Margin="0,24,0,0" Spacing="8">
                                        <TextBlock Text="Nouveau Projet" Style="{StaticResource SubtitleTextBlockStyle}" FontWeight="Bold"/>
                                        <TextBlock Text="Créer un nouveau module à partir de zéro." 
                                                   Style="{StaticResource BodyTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                                    </StackPanel>
                                    
                                    <FontIcon Grid.Row="2" Glyph="&#xE76C;" HorizontalAlignment="Right" FontSize="16" Foreground="{ThemeResource TextFillColorTertiaryBrush}" Margin="0,12,0,0"/>
                                </Grid>
                            </Button>

                            <!-- Clone Card -->
                            <Button Grid.Column="1" Click="OnCloneProjectClick" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                    Padding="0" BorderThickness="1" Background="{ThemeResource LayerFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" CornerRadius="8">
                                <Grid Padding="24">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <FontIcon Glyph="&#xE96D;" FontSize="40" HorizontalAlignment="Left" Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                                    
                                    <StackPanel Grid.Row="1" Margin="0,24,0,0" Spacing="8">
                                        <TextBlock Text="Cloner un Dépôt" Style="{StaticResource SubtitleTextBlockStyle}" FontWeight="Bold"/>
                                        <TextBlock Text="Télécharger un module existant depuis Git." 
                                                   Style="{StaticResource BodyTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                                    </StackPanel>
                                    
                                    <FontIcon Grid.Row="2" Glyph="&#xE76C;" HorizontalAlignment="Right" FontSize="16" Foreground="{ThemeResource TextFillColorTertiaryBrush}" Margin="0,12,0,0"/>
                                </Grid>
                            </Button>

                            <!-- Open Card -->
                            <Button Grid.Column="2" Click="OnOpenLocalProjectClick" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                    Padding="0" BorderThickness="1" Background="{ThemeResource LayerFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" CornerRadius="8">
                                <Grid Padding="24">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <FontIcon Glyph="&#xE8B7;" FontSize="40" HorizontalAlignment="Left" Foreground="{ThemeResource TextFillColorPrimaryBrush}"/>
                                    
                                    <StackPanel Grid.Row="1" Margin="0,24,0,0" Spacing="8">
                                        <TextBlock Text="Ouvrir Local" Style="{StaticResource SubtitleTextBlockStyle}" FontWeight="Bold"/>
                                        <TextBlock Text="Ouvrir un dossier de module sur votre PC." 
                                                   Style="{StaticResource BodyTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextWrapping="Wrap"/>
                                    </StackPanel>
                                    
                                    <FontIcon Grid.Row="2" Glyph="&#xE76C;" HorizontalAlignment="Right" FontSize="16" Foreground="{ThemeResource TextFillColorTertiaryBrush}" Margin="0,12,0,0"/>
                                </Grid>
                            </Button>
                        </Grid>

                        <!-- Tests & Debugging -->
                        <StackPanel Spacing="16" Padding="0,16,0,0">
                            <TextBlock Text="Tests et Debugging" Style="{StaticResource SubtitleTextBlockStyle}"/>
                            <StackPanel Orientation="Horizontal" Spacing="16">
                                <Button Click="OnLoadModuleClick" Padding="12,8">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <FontIcon Glyph="&#xE7C3;"/>
                                        <TextBlock Text="Charger un module (.exe)"/>
                                    </StackPanel>
                                </Button>
                                
                                <Button Click="OnVerifyManifestClick" Padding="12,8">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <FontIcon Glyph="&#xE90F;"/>
                                        <TextBlock Text="Vérifier le manifeste"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>

                        <!-- Console Output -->
                        <StackPanel Spacing="12">
                             <TextBlock Text="Console de Sortie" Style="{StaticResource SubtitleTextBlockStyle}"/>
                             <TextBox Text="{x:Bind ConsoleOutput, Mode=OneWay}" IsReadOnly="True" 
                                      Background="Black" Foreground="White" FontFamily="Consolas" 
                                      Height="200" AcceptsReturn="True" ScrollViewer.VerticalScrollBarVisibility="Auto"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </PivotItem>

            <!-- Item 2: Gestion du Projet -->
            <PivotItem Header="Gestion du Projet">
                 <Grid>
                     <!-- State A: Repository View (Module List) -->
                     <Grid x:Name="RepoGrid" Visibility="Visible" Padding="24">
                         <Grid.RowDefinitions>
                             <RowDefinition Height="Auto"/>
                             <RowDefinition Height="*"/>
                         </Grid.RowDefinitions>
                         
                         <StackPanel Spacing="8" Margin="0,0,0,24">
                             <TextBlock Text="Modules du Dépôt" Style="{StaticResource SubtitleTextBlockStyle}"/>
                             <TextBlock Text="Sélectionnez un module pour l'éditer ou en créer un nouveau." Style="{StaticResource BodyTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                         </StackPanel>
                         
                         <GridView Grid.Row="1" ItemsSource="{x:Bind SelectedProject.Modules, Mode=OneWay}" SelectionMode="Single" IsItemClickEnabled="True" ItemClick="ModuleList_ItemClick">
                             <GridView.ItemTemplate>
                                 <DataTemplate x:DataType="dev:DevModule">
                                     <Grid Width="200" Height="140" Padding="12" Background="{ThemeResource LayerFillColorDefaultBrush}" 
                                           BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="1" CornerRadius="8">
                                         <Grid.RowDefinitions>
                                             <RowDefinition Height="*"/>
                                             <RowDefinition Height="Auto"/>
                                             <RowDefinition Height="Auto"/>
                                         </Grid.RowDefinitions>
                                         
                                         <!-- Icon & Name -->
                                         <StackPanel>
                                            <Image Source="{x:Bind Manifest.IconUrl, Mode=OneWay, FallbackValue='ms-appx:///Assets/StoreLogo.png'}" 
                                                   Width="40" Height="40" HorizontalAlignment="Left" Margin="0,0,0,12"/>
                                            <TextBlock Text="{x:Bind Manifest.Name, Mode=OneWay}" Style="{StaticResource BodyStrongTextBlockStyle}" TextTrimming="CharacterEllipsis"/>
                                         </StackPanel>
                                         
                                         <TextBlock Grid.Row="1" Text="{x:Bind Manifest.Id, Mode=OneWay}" Style="{StaticResource CaptionTextBlockStyle}" 
                                                    Foreground="{ThemeResource TextFillColorSecondaryBrush}" TextTrimming="CharacterEllipsis" Margin="0,4,0,0"/>

                                         <TextBlock Grid.Row="2" Text="{x:Bind Manifest.Version, Mode=OneWay}" Style="{StaticResource CaptionTextBlockStyle}" 
                                                    Foreground="{ThemeResource TextFillColorTertiaryBrush}" HorizontalAlignment="Right" Margin="0,8,0,0"/>
                                     </Grid>
                                 </DataTemplate>
                             </GridView.ItemTemplate>
                         </GridView>

                         <!-- Floating Create Button -->
                         <Button Grid.Row="1" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,0,0,0" Style="{StaticResource AccentButtonStyle}" Click="OnNewModuleWizardClick">
                             <StackPanel Orientation="Horizontal" Spacing="8">
                                 <FontIcon Glyph="&#xE710;"/>
                                 <TextBlock Text="Nouveau Module"/>
                             </StackPanel>
                         </Button>
                     </Grid>

                     <!-- State B: Editor View -->
                     <Grid x:Name="EditorGrid" Visibility="Collapsed">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Toolbar -->
                        <Grid Padding="24,12" Background="{ThemeResource SolidBackgroundFillColorBaseBrush}" BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}" BorderThickness="0,0,0,1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/> <!-- Back Button -->
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <Button Click="BackToRepo_Click" Margin="0,0,16,0" Style="{StaticResource SubtleButtonStyle}">
                                <FontIcon Glyph="&#xE72B;"/> <!-- Back Arrow -->
                            </Button>
                            
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock Text="{x:Bind SelectedModule.Manifest.Name, Mode=OneWay, FallbackValue='Module Name'}" Style="{StaticResource TitleTextBlockStyle}"/>
                                <TextBlock Text="{x:Bind SelectedModule.ModulePath, Mode=OneWay}" Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            </StackPanel>
                            
                            <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="12">
                                <Button Click="Save_Click">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <SymbolIcon Symbol="Save"/>
                                        <TextBlock Text="Enregistrer"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </Grid>

                        <Pivot Grid.Row="1" Padding="24,12">
                            <!-- Tab 1: Manifest -->
                            <PivotItem Header="Manifest">
                                <ScrollViewer>
                                    <StackPanel Spacing="24" MaxWidth="700" HorizontalAlignment="Left" Padding="0,0,24,0">
                                        <InfoBar Severity="Informational" IsOpen="True" IsClosable="False" Message="Informations d'identité de base pour le système de modules."/>
                                        <Grid ColumnSpacing="24" RowSpacing="16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            <TextBox Header="Module ID (Unique)" Text="{x:Bind SelectedModule.Manifest.Id, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="e.g. winbridge-ipcalc"/>
                                            <TextBox Grid.Column="1" Header="Version" Text="{x:Bind SelectedModule.Manifest.Version, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="1.0.0"/>
                                            <TextBox Grid.Row="1" Header="Nom d'affichage" Text="{x:Bind SelectedModule.Manifest.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="ex: Calculatrice IP"/>
                                            <TextBox Grid.Row="1" Grid.Column="1" Header="Auteur" Text="{x:Bind SelectedModule.Manifest.Author, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="Votre Nom"/>
                                        </Grid>
                                        <TextBox Header="Description courte (Carte)" Text="{x:Bind SelectedModule.Manifest.ShortDescription, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                 MaxLength="120" TextWrapping="Wrap" Height="70" Description="Visible sur la carte du Store (env. 2 lignes)."/>
                                        <TextBox Header="Description complète (Markdown)" Text="{x:Bind SelectedModule.Manifest.FullDescription, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                 AcceptsReturn="True" Height="300" FontFamily="Consolas" Description="Description détaillée affichée sur la page du module."/>
                                    </StackPanel>
                                </ScrollViewer>
                            </PivotItem>

                            <!-- Tab 2: Store & Tags -->
                            <PivotItem Header="Store &amp; Tags">
                                <ScrollViewer>
                                    <StackPanel Spacing="24" MaxWidth="800">
                                        <InfoBar Severity="Informational" IsOpen="True" IsClosable="False" Message="Métadonnées utilisées pour la recherche et le filtrage dans le Store."/>
                                        <StackPanel Spacing="8">
                                            <TextBox Header="URL de l'icône" Text="{x:Bind SelectedModule.Manifest.IconUrl, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" PlaceholderText="https://..."/>
                                            <StackPanel Orientation="Horizontal" Spacing="12">
                                                <Image Source="{x:Bind SelectedModule.Manifest.IconUrl, Mode=OneWay}" Width="48" Height="48" VerticalAlignment="Top"/>
                                                <TextBlock Text="Aperçu" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            </StackPanel>
                                        </StackPanel>
                                        <StackPanel Spacing="8">
                                            <TextBlock Text="Catégories" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                            <GridView ItemsSource="{x:Bind AvailableCategories}" SelectionMode="None">
                                                <GridView.ItemTemplate>
                                                    <DataTemplate>
                                                        <CheckBox Content="{Binding Name}" IsChecked="{Binding IsSelected, Mode=TwoWay}" Margin="0,0,16,8"/>
                                                    </DataTemplate>
                                                </GridView.ItemTemplate>
                                            </GridView>
                                        </StackPanel>
                                        <StackPanel Spacing="8">
                                            <TextBlock Text="Testé sur (Compatibilité OS)" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                            <GridView ItemsSource="{x:Bind AvailableOS}" SelectionMode="None">
                                                <GridView.ItemTemplate>
                                                    <DataTemplate>
                                                        <CheckBox Content="{Binding Name}" IsChecked="{Binding IsSelected, Mode=TwoWay}" Margin="0,0,16,8"/>
                                                    </DataTemplate>
                                                </GridView.ItemTemplate>
                                            </GridView>
                                        </StackPanel>
                                        <StackPanel Spacing="8">
                                            <StackPanel Orientation="Horizontal" Spacing="12">
                                                <TextBlock Text="Captures d'écran (URLs)" Style="{StaticResource BodyStrongTextBlockStyle}" VerticalAlignment="Center"/>
                                                <Button Content="Ajouter URL" Click="AddScreenshot_Click" Padding="8,4" MinHeight="0"/>
                                            </StackPanel>
                                            <ItemsControl ItemsSource="{x:Bind ScreenshotList, Mode=OneWay}">
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <Grid Margin="0,4" ColumnSpacing="8">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition Width="*"/>
                                                                <ColumnDefinition Width="Auto"/>
                                                            </Grid.ColumnDefinitions>
                                                            <TextBox Text="{Binding Url, Mode=TwoWay}" PlaceholderText="https://..."/>
                                                            <Button Grid.Column="1" Content="&#xE74D;" FontFamily="Segoe MDL2 Assets" Click="RemoveScreenshot_Click" Tag="{Binding}"/>
                                                        </Grid>
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </StackPanel>
                                    </StackPanel>
                                </ScrollViewer>
                            </PivotItem>

                            <!-- Tab 3: Build & Publish -->
                            <PivotItem Header="Build">
                                <StackPanel Spacing="24" MaxWidth="800" HorizontalAlignment="Left">
                                    <InfoBar Title="Pipeline de Build" IsOpen="True" Severity="Informational" IsClosable="False"
                                             Message="Ce processus exécutera 'dotnet publish -c Release', créera une archive ZIP et calculera le hachage SHA256 requis pour le Store."/>
                                    <Button x:Name="BuildButton" Click="Build_Click" Style="{StaticResource AccentButtonStyle}" MinWidth="200">
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <FontIcon Glyph="&#xE770;"/>
                                            <TextBlock Text="Construire &amp; Paqueter"/>
                                        </StackPanel>
                                    </Button>
                                    <StackPanel x:Name="ProgressPanel" Visibility="Collapsed" Spacing="12">
                                        <ProgressBar IsIndeterminate="True"/>
                                        <TextBlock Text="Empaquetage du module... veuillez patienter." HorizontalAlignment="Center"/>
                                    </StackPanel>
                                    <StackPanel x:Name="BuildResultsPanel" Visibility="Collapsed" Spacing="16" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" Padding="20" CornerRadius="8" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                                        <StackPanel Orientation="Horizontal" Spacing="12">
                                            <FontIcon Glyph="&#xE930;" FontSize="24" Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                                            <TextBlock Text="Build Réussi" Style="{StaticResource SubtitleTextBlockStyle}"/>
                                        </StackPanel>
                                        <TextBox Header="Chemin du ZIP généré" Text="{x:Bind GeneratedZipPath, Mode=OneWay}" IsReadOnly="True"/>
                                        <Grid ColumnSpacing="12">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBox Header="Hachage SHA256" Text="{x:Bind GeneratedHash, Mode=OneWay}" IsReadOnly="True" FontFamily="Consolas"/>
                                            <Button VerticalAlignment="Bottom" Click="CopyHash_Click" ToolTipService.ToolTip="Copier Hachage">
                                                <SymbolIcon Symbol="Copy"/>
                                            </Button>
                                        </Grid>
                                        <TextBlock Text="Snippet JSON Marketplace" Style="{StaticResource BodyStrongTextBlockStyle}" Margin="0,8,0,0"/>
                                        <TextBox Text="{x:Bind GeneratedSnippet, Mode=OneWay}" IsReadOnly="True" AcceptsReturn="True" Height="250" FontFamily="Consolas"/>
                                        <TextBlock Text="Copiez ce bloc JSON dans le fichier 'marketplace.json' de votre dépôt GitHub." Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                </StackPanel>
                            </PivotItem>

                            <!-- Tab 4: Preview (Aperçu) -->
                            <PivotItem Header="Aperçu">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <TextBlock Text="Aperçu de la carte Store" Style="{StaticResource SubtitleTextBlockStyle}" Margin="0,0,0,24"/>
                                    <Grid HorizontalAlignment="Left" VerticalAlignment="Top"
                                          Width="300" Height="180" 
                                          Background="{ThemeResource CardBackgroundFillColorDefaultBrush}" 
                                          CornerRadius="8" Padding="16" 
                                          BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}" BorderThickness="1">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Image Source="{x:Bind SelectedModule.Manifest.IconUrl, Mode=OneWay, FallbackValue='ms-appx:///Assets/StoreLogo.png'}" 
                                                   Width="32" Height="32" Margin="0,0,12,0" VerticalAlignment="Top"/>
                                            <StackPanel Grid.Column="1">
                                                <TextBlock Text="{x:Bind SelectedModule.Manifest.Name, Mode=OneWay, FallbackValue='Module Name'}" 
                                                           Style="{StaticResource BodyStrongTextBlockStyle}" TextTrimming="CharacterEllipsis"/>
                                                <TextBlock Text="{x:Bind SelectedModule.Manifest.Author, Mode=OneWay, FallbackValue='Author'}" 
                                                           Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                            </StackPanel>
                                        </Grid>
                                        <TextBlock Grid.Row="1" Text="{x:Bind SelectedModule.Manifest.ShortDescription, Mode=OneWay, FallbackValue='Short description of the module...'}" 
                                                   Style="{StaticResource BodyTextBlockStyle}" 
                                                   TextWrapping="Wrap" TextTrimming="CharacterEllipsis" 
                                                   Margin="0,12,0,0" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,12,0,0" Spacing="8">
                                            <TextBlock Text="{x:Bind SelectedModule.Manifest.Version, Mode=OneWay, FallbackValue='1.0.0'}" 
                                                       Style="{StaticResource CaptionTextBlockStyle}" Foreground="{ThemeResource TextFillColorTertiaryBrush}"/>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                            </PivotItem>

                        </Pivot>
                     </Grid>
                 </Grid>
            </PivotItem>
        </Pivot>
        
        <!-- Success Notification -->
        <TeachingTip x:Name="SuccessTip" Title="Projet créé" Subtitle="Le nouveau module a été initialisé avec succès."
                     PreferredPlacement="BottomRight" PlacementMargin="20" IsLightDismissEnabled="True"
                     ActionButtonContent="Ouvrir le dossier" ActionButtonClick="SuccessTip_ActionButtonClick"/>
    </Grid>

</Page>
